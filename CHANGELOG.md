# Changelog

## 3.0.0

### BREAKING: JavaScript files now use dynamic imports

Component JavaScript is now loaded using [dynamic imports](https://javascript.info/modules-dynamic-imports). Dynamic imports uses a Promises-like interface that allows for only loading a JavaScript file at the time that it's needed rather than loading one or more pre-compiled files on page load, providing some performance benefits (especially on sites that use a lot of JavaScript).

As a result, Felafel version 3 can only be used with browsers that support dynamic imports, which includes [most modern browsers](https://caniuse.com/es6-module-dynamic-import), but not Internet Explorer and pre-Chromium Edge. These browsers are thus no longer supported.

- JavaScript code is no longer passed through Browserify and Babel.
- The location of the compiled `all.js` file has moved from `dist/all.js` to `dist/js/all.js`.
- The uncompiled `all.js` file no longer exports component classes or the `initAll` function. `initAll` is instead being directly bound to the `window.fs` object, and components should be imported from their individual files instead.
- Loading individual components has changed to use the new `loadModule` method. The `initAll` function is unchanged.
- Individual components are now referred to under a single name, rather than having

Old style:

```javascript
// Auto-initialise data-module components (in browser)
window.fs.initAll();

// Manually initialise an individual component (in browser)
const tabsElement = document.getElementById("tabs");
new window.fs.Tabs(tabsElement);

// Import an individual component (in JS)
import { Tabs } from "@querkmachine/felafel";
```

New style:

```javascript
// Auto-initialise data-module components
window.fs.initAll();

// Manually initialise an individual component
const tabsElement = document.getElementById("tabs");
window.fs.loadModule("tabs").then((module) => {
  new module.default(tabsElement);
});

// Import an individual component (in JS)
import Tabs from "@querkmachine/felafel/dist/components/tabs";
```

### Other breaking changes

- All versions of Microsoft Internet Explorer and pre-Chromium Microsoft Edge (EdgeHTML) are no longer supported.
- The JS class exported by the tabs component has been changed from "Tab" to "Tabs".

### Changes to Sass configuration maps

In v2.0.0, Sass configuration maps that were modified on import started being merged rather than overwritten. This allowed for built-in styles to be more opinionated as there was a guarantee that certain options would exist, however this also resulted in a significant amount of unnecessary CSS being generated for styles that might never be used.

In version 3, there are now options to specifically enable or disable merging behaviour. Merging is enabled by default to maintain consistency with version 2 of Felafel.

As there is no longer a guarantee that options used by default components will exist, additional checks have been added to the functions and mixins that use them to ensure existence before use. In the situation that the specified option does not exist, one or more style rules may be omitted.

- Added new global configuration options to control configuration map merging behaviour (all default to `true`):
  - Globally enable or disable configuration map merging: `$fs-merge-config-maps`.
  - Enable or disable for `$fs-breakpoints` only: `$fs-merge-breakpoints`.
  - Enable or disable for `$fs-color-palette` only: `$fs-merge-colour-palette`.
  - Enable or disable for `$fs-spacing` only: `$fs-merge-spacing`.
  - Enable or disable for `$fs-font-stacks` only: `$fs-merge-font-stacks`.
  - Enable or disable for `$fs-font-sizes` only: `$fs-merge-font-sizes`.
- Existence checks for configuration map keys have been changed from using `@error`—which would exit compilation without completion—to `@warn`, allowing for compilation to continue even if a configuration map key doesn't exist.

### Everything else

- Right-to-left (RTL) versions of the CSS can be generated by adding `--dir rtl` flag to the build or serve npm commands. For example, `npm run build -- --dir rtl`.
  - This is possible due to the move to using Logical Properties and Values.
  - A new helper, `arrows.fs-arrow`, has been added to generate arrows using logical directions.
- Pre-compiled CSS and JS files are now minified.
- Pre-compiled CSS is now passed through [postcss-preset-env](https://preset-env.cssdb.org), allowing for the use of next generation CSS features.
- Heading elements used in the Prose component now have additional leading margin.
- Added a new helper, `reset.fs-reset-details`, that removes the default arrow used on details/summary elements.

## 2.2.0

- Added Avatar component.
- Added Toggle component.
- Fixed color override classes using the default settings map instead of the merged map.

## 2.1.0

- Added some new global configuration options:
  - `$fs-check-radio-margin`: Controls spacing between input and labelling on Checkbox and Radio components.
  - `$fs-form-element-horizontal-padding` and `$fs-form-element-vertical-padding`: Controls the horizontal (left/right) and vertical (top/bottom) padding on the text-like form components — File Upload, Input, Select, Textarea.
- Added some new component configuration options:
  - Checkbox: `$check-stroke`, `$label-margin`.
  - Radio: `$label-margin`.
  - Select: `$show-arrow`, `$arrow-color`, `$arrow-size`, `$arrow-stroke`.
- Breadcrumbs: Added `aria-current` style.
- Fixed deprecation warnings about use of slash (/) for division. This feature [is being removed](https://sass-lang.com/documentation/breaking-changes/slash-div) from a future version of Dart Sass.

## 2.0.0

A huge bunch of changes, including our first real backwards compatibility breaking changes.

### BREAKING: Configuration maps are now merged, not replaced

This release simplifies the customisation of a number of global and component-level options. Configuration maps are now merged together when built, allowing for the modification of existing options and addition of new options without having to rewrite the entire map. At the same time, some of these maps have been renamed to be more consistent with other maps.

The following configurations have been updated to work in this way:

- Breakpoints (using `$fs-breakpoints`).
- Colour palette (`$fs-color-palette`). This variable was previously named `$fs-default-color-palette`. That variable, though still existing, can no longer be overridden via Felafel configuration.
- Spacings (`$fs-spacing`). This was previously named `$fs-spacing-responsive`.
- Font stacks (`$fs-font-stacks`).
- Font sizes (`$fs-font-sizes`). This was previously named `$fs-font-sizes-responsive`.

### BREAKING: Component configuration options are now defined per-component

Configuration options for components are now tied to the individal component instead of all being configured via a single settings file.

At the same time, component variables have had the fs and component namespaces removed as they're unnecessary now that settings are scoped to each component. Global variables currently retain the fs namespace.

For example, in versions earlier 2.0.0 your button style definition might've looked like this:

```
@use "felafel/src/scss/settings" with (
  $fs-brand-color: #786999,
  $fs-button-background-color: #ffcc00,
  $fs-button-border-width: 2px,
  $fs-button-border-radius: 10px
);
@use "felafel/src/scss/components/button";
```

From version 2.0.0 onwards, it looks more like this:

```
@use "felafel/src/scss/settings" with (
  $fs-brand-color: #786999
);
@use "felafel/src/scss/components/button" with (
  $background-color: #ffcc00,
  $border-width: 2px,
  $border-radius: 10px
);
```

Configuration options for the Input component are the sole exceptions to this change. The Input options couldn't be easily moved as they were also being used for the Checkbox, Radio, Select and Textarea components. These options have instead stayed in the global scope and been renamed to better indicate their use.

- `$fs-input-background-color` → `$fs-form-element-background-color`
- `$fs-input-border-color` → `$fs-form-element-border-color`
- `$fs-input-border-radius` → `$fs-form-element-border-radius`
- `$fs-input-text-color` → `$fs-form-element-text-color`

### Other breaking changes

- Refactored `$fs-font-stacks` and associated helpers to use lists instead of strings when passing font stacks. Replace your surrounding quotes with parentheses and have a nice day.
- Refactored Hero component to remove use of `@extend`. Hero heading size is now defined in HTML.
- Refactored Select component, replacing the SVG arrow icon with a HTML/CSS equivalent. This requires a small HTML change to add a new wrapping element around instances of `<select>`.
- Merged Masthead and Masthead Tools components' Sass partials together. You now only have to import the Masthead partial to get the styles for both.

### Everything else

- Added Choice Card component.
- Added configuration option to change the Masthead top border width (`$border-top-width`).
- Added configuration options to control border-radius on the Testimonial component's speech bubble (`$border-radius`) and avatar (`$avatar-border-radius`).
- Added configuration options to hide a browser's default controls for Input component `type`s 'number' (`$number-hide-controls`) and 'search' (`$search-hide-controls`). Both default to `true` to maintain the default styling from previous versions.
- Added configuration option to define the selection (text highlight) colour (`$fs-selection-color`).
- Refactored multiple instances of `if` and `fs-contrasting-color` into a new `colors` function: `fs-color-if-set`.
- Fixed Form Rows within Fieldsets producing a double bottom margin.
- Fixed unprefixed uses of appearance CSS property.
- Fixed `fs-selection-highlight` mixin not being used by the selection core style.
- Fixed selection core style not being behind the `$fs-enable-core-styles` flag.
- Fixed input masks having incorrectly rounded corners if rounded corners are enabled.

## v1.1.1

- Removed unused .npmrc file.

## v1.1.0

- Added Breadcrumbs component.
- Added Card component.
- Added Details component.
- Added Empty component.
- Added File Upload (Drag and Drop) variant.
- Added Fat Footer component.
- Added Hero component.
- Added Pagination component.
- Added Testimonial component.
- Added Button variant: `[data-appearance="link"]`.
- Added `fs-color` function to grab colours from `$fs-default-colour-palette` without referencing it directly.
- Modified Primary Navigation styling.
- Fixed font family override classes not accounting for what is passed as configuration.

## v1.0.0

- Initial release.
