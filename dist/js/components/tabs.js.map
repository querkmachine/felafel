{"version":3,"names":[],"mappings":"","sources":["components/tabs.js"],"sourcesContent":["// This component's JS is heavily based on that produced by the Government Digital Service.\n// Hat tip to them and the GOV.UK team.\n// https://github.com/alphagov/govuk-frontend/blob/master/src/govuk/components/tabs/tabs.js\n\nimport { KeyCodes } from \"../helpers/key-codes.js\";\n\nclass Tab {\n  constructor($module) {\n    this.$module = $module;\n    this.$tabs = $module.querySelectorAll(\".fs-tabs__tab\");\n    this.$tablist = $module.querySelector(\".fs-tabs__list\");\n    this.$tablistItems = $module.querySelectorAll(\".fs-tabs__item\");\n    this.panelHiddenClass = \"fs-tabs__panel--hidden\";\n    // If we're missing any part, exit now or things will break\n    if (!this.$tabs || !this.$tablist || !this.$tablistItems) {\n      return;\n    }\n    this.create();\n  }\n\n  /**\n   * Initialisation methods\n   */\n  create() {\n    // Setup a11y roles\n    this.$tablist.setAttribute(\"role\", \"tablist\");\n    this.$tablistItems.forEach(($item) => {\n      $item.setAttribute(\"role\", \"presentation\");\n    });\n    // Tab functionality\n    this.$tabs.forEach(($item) => {\n      this.setAttributes($item);\n      $item.boundTabClick = this.onTabClick.bind(this);\n      $item.boundTabKeydown = this.onTabKeydown.bind(this);\n      $item.addEventListener(\"click\", $item.boundTabClick, true);\n      $item.addEventListener(\"keydown\", $item.boundTabKeydown, true);\n      this.hideTab($item);\n    });\n    // Set active tab\n    const $activeTab = this.getTab(window.location.hash) || this.$tabs[0];\n    this.showTab($activeTab);\n    // Hashchange events\n    this.$module.boundOnHashChange = this.onHashChange.bind(this);\n    window.addEventListener(\"hashchange\", this.$module.boundOnHashChange, true);\n  }\n  destroy() {\n    // Remove a11y roles\n    this.$tablist.removeAttribute(\"role\");\n    this.$tablistItems.forEach(($item) => {\n      $item.removeAttribute(\"role\", \"presentation\");\n    });\n    // Remove tab functionality\n    this.$tabs.forEach(($item) => {\n      $item.removeEventListener(\"click\", $item.boundTabClick, true);\n      $item.removeEventListener(\"keydown\", $item.boundTabKeydown, true);\n      this.unsetAttributes($item);\n    });\n    // Remove hashchange event\n    window.removeEventListener(\n      \"hashchange\",\n      this.$module.boundOnHashChange,\n      true\n    );\n  }\n  setAttributes($tab) {\n    // Set default tab attributes\n    const panelId = this.getHref($tab).slice(1);\n    $tab.setAttribute(\"id\", panelId + \"-Tab\");\n    $tab.setAttribute(\"role\", \"tab\");\n    $tab.setAttribute(\"aria-controls\", panelId);\n    $tab.setAttribute(\"aria-selected\", \"false\");\n    $tab.setAttribute(\"tabindex\", \"-1\");\n    // Set default panel attributes\n    const $panel = this.getPanel($tab);\n    $panel.setAttribute(\"role\", \"tabpanel\");\n    $panel.setAttribute(\"aria-labelledby\", $tab.id);\n    $panel.classList.add(this.panelHiddenClass);\n  }\n  unsetAttributes($tab) {\n    // Unset tab attributes\n    $tab.removeAttribute(\"id\");\n    $tab.removeAttribute(\"role\");\n    $tab.removeAttribute(\"aria-controls\");\n    $tab.removeAttribute(\"aria-selected\");\n    $tab.removeAttribute(\"tabindex\");\n    // Unset panel attributes\n    const $panel = this.getPanel($tab);\n    $panel.removeAttribute(\"role\");\n    $panel.removeAttribute(\"aria-labelledby\");\n    $panel.classList.remove(this.panelHiddenClass);\n  }\n\n  /**\n   * Hash/history usage\n   */\n  onHashChange(e) {\n    const $hashTab = this.getTab(window.location.hash);\n    if (!$hashTab) {\n      return;\n    }\n    // Prevent changing hash\n    if (this.changingHash) {\n      this.changingHash = false;\n      return;\n    }\n    // Set active tba according to URL hash\n    const $previousTab = this.getCurrentTab();\n    this.hideTab($previousTab);\n    this.showTab($hashTab);\n    $hashTab.focus();\n  }\n  createHistoryEntry($tab) {\n    let $panel = this.getPanel($tab);\n    // This code prevents the page from jumping to the new target hash.\n    // 1. Saves the panel ID into memory.\n    // 2. Remove the ID from the panel.\n    // 3. Change the hash in the URL.\n    // 4. Applies the ID from memory back to the panel.\n    const id = $panel.id;\n    $panel.id = \"\";\n    this.changingHash = true;\n    window.location.hash = this.getHref($tab).slice(1);\n    $panel.id = id;\n  }\n\n  /**\n   * Tab methods\n   */\n  getTab(hash) {\n    return this.$module.querySelector(`.fs-tabs__tab[href=\"${hash}\"]`);\n  }\n  getCurrentTab() {\n    return this.$module.querySelector(\".fs-tabs__item--current .fs-tabs__tab\");\n  }\n  hideTab($tab) {\n    this.unhighlightTab($tab);\n    this.hidePanel($tab);\n  }\n  showTab($tab) {\n    this.highlightTab($tab);\n    this.showPanel($tab);\n  }\n  unhighlightTab($tab) {\n    $tab.setAttribute(\"aria-selected\", \"false\");\n    $tab.parentNode.classList.remove(\"fs-tabs__item--current\");\n    $tab.setAttribute(\"tabindex\", \"-1\");\n  }\n  highlightTab($tab) {\n    $tab.setAttribute(\"aria-selected\", \"true\");\n    $tab.parentNode.classList.add(\"fs-tabs__item--current\");\n    $tab.setAttribute(\"tabindex\", \"0\");\n  }\n  activateNextTab() {\n    const $currentTab = this.getCurrentTab();\n    const $nextTablistItem = $currentTab.parentNode.nextElementSibling;\n    let $nextTab;\n    if ($nextTablistItem) {\n      $nextTab = $nextTablistItem.querySelector(\".fs-tabs__tab\");\n    }\n    if ($nextTab) {\n      this.hideTab($currentTab);\n      this.showTab($nextTab);\n      $nextTab.focus();\n      this.createHistoryEntry($nextTab);\n    }\n  }\n  activatePreviousTab() {\n    const $currentTab = this.getCurrentTab();\n    const $previousTablistItem = $currentTab.parentNode.previousElementSibling;\n    let $previousTab;\n    if ($previousTablistItem) {\n      $previousTab = $previousTablistItem.querySelector(\".fs-tabs__tab\");\n    }\n    if ($previousTab) {\n      this.hideTab($currentTab);\n      this.showTab($previousTab);\n      $previousTab.focus();\n      this.createHistoryEntry($previousTab);\n    }\n  }\n\n  /**\n   * Panel methods\n   */\n  getPanel($tab) {\n    return this.$module.querySelector(this.getHref($tab));\n  }\n  showPanel($tab) {\n    const $panel = this.getPanel($tab);\n    $panel.classList.remove(this.panelHiddenClass);\n  }\n  hidePanel($tab) {\n    const $panel = this.getPanel($tab);\n    $panel.classList.add(this.panelHiddenClass);\n  }\n\n  /**\n   * Mouse/keyboard handlers\n   */\n  onTabClick(e) {\n    if (!e.target.classList.contains(\"fs-tabs__tab\")) {\n      return false;\n    }\n    e.preventDefault();\n    const $newTab = e.target;\n    const $currentTab = this.getCurrentTab();\n    this.hideTab($currentTab);\n    this.showTab($newTab);\n    this.createHistoryEntry($newTab);\n  }\n  onTabKeydown(e) {\n    switch (e.which || e.keyCode) {\n      case KeyCodes().LEFT:\n      case KeyCodes().UP:\n        this.activatePreviousTab();\n        e.preventDefault();\n        break;\n      case KeyCodes().RIGHT:\n      case KeyCodes().DOWN:\n        this.activateNextTab();\n        e.preventDefault();\n        break;\n    }\n  }\n\n  /**\n   * Helpers\n   */\n  getHref($tab) {\n    const href = $tab.getAttribute(\"href\");\n    const hash = href.slice(href.indexOf(\"#\"), href.length);\n    return hash;\n  }\n}\n\nexport default Tab;\n"],"file":"tabs.js"}