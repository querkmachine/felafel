{"version":3,"file":"tabs.js","sources":["components/tabs.js"],"sourcesContent":["// This component's JS is heavily based on that produced by the Government Digital Service.\n// Hat tip to them and the GOV.UK team.\n// https://github.com/alphagov/govuk-frontend/blob/master/src/govuk/components/tabs/tabs.js\n\nimport { KeyCodes } from \"../helpers/key-codes.js\";\n\nclass Tabs {\n  constructor($module) {\n    this.$module = $module;\n    this.$tabs = $module.querySelectorAll(\".fs-tabs__tab\");\n    this.$tablist = $module.querySelector(\".fs-tabs__list\");\n    this.$tablistItems = $module.querySelectorAll(\".fs-tabs__item\");\n    this.panelHiddenClass = \"fs-tabs__panel--hidden\";\n    // If we're missing any part, exit now or things will break\n    if (!this.$tabs || !this.$tablist || !this.$tablistItems) {\n      return;\n    }\n    this.create();\n  }\n\n  /**\n   * Initialisation methods\n   */\n  create() {\n    // Setup a11y roles\n    this.$tablist.setAttribute(\"role\", \"tablist\");\n    this.$tablistItems.forEach(($item) => {\n      $item.setAttribute(\"role\", \"presentation\");\n    });\n    // Tab functionality\n    this.$tabs.forEach(($item) => {\n      this.setAttributes($item);\n      $item.boundTabClick = this.onTabClick.bind(this);\n      $item.boundTabKeydown = this.onTabKeydown.bind(this);\n      $item.addEventListener(\"click\", $item.boundTabClick, true);\n      $item.addEventListener(\"keydown\", $item.boundTabKeydown, true);\n      this.hideTab($item);\n    });\n    // Set active tab\n    const $activeTab = this.getTab(window.location.hash) || this.$tabs[0];\n    this.showTab($activeTab);\n    // Hashchange events\n    this.$module.boundOnHashChange = this.onHashChange.bind(this);\n    window.addEventListener(\"hashchange\", this.$module.boundOnHashChange, true);\n  }\n  destroy() {\n    // Remove a11y roles\n    this.$tablist.removeAttribute(\"role\");\n    this.$tablistItems.forEach(($item) => {\n      $item.removeAttribute(\"role\", \"presentation\");\n    });\n    // Remove tab functionality\n    this.$tabs.forEach(($item) => {\n      $item.removeEventListener(\"click\", $item.boundTabClick, true);\n      $item.removeEventListener(\"keydown\", $item.boundTabKeydown, true);\n      this.unsetAttributes($item);\n    });\n    // Remove hashchange event\n    window.removeEventListener(\n      \"hashchange\",\n      this.$module.boundOnHashChange,\n      true\n    );\n  }\n  setAttributes($tab) {\n    // Set default tab attributes\n    const panelId = this.getHref($tab).slice(1);\n    $tab.setAttribute(\"id\", panelId + \"-Tab\");\n    $tab.setAttribute(\"role\", \"tab\");\n    $tab.setAttribute(\"aria-controls\", panelId);\n    $tab.setAttribute(\"aria-selected\", \"false\");\n    $tab.setAttribute(\"tabindex\", \"-1\");\n    // Set default panel attributes\n    const $panel = this.getPanel($tab);\n    $panel.setAttribute(\"role\", \"tabpanel\");\n    $panel.setAttribute(\"aria-labelledby\", $tab.id);\n    $panel.classList.add(this.panelHiddenClass);\n  }\n  unsetAttributes($tab) {\n    // Unset tab attributes\n    $tab.removeAttribute(\"id\");\n    $tab.removeAttribute(\"role\");\n    $tab.removeAttribute(\"aria-controls\");\n    $tab.removeAttribute(\"aria-selected\");\n    $tab.removeAttribute(\"tabindex\");\n    // Unset panel attributes\n    const $panel = this.getPanel($tab);\n    $panel.removeAttribute(\"role\");\n    $panel.removeAttribute(\"aria-labelledby\");\n    $panel.classList.remove(this.panelHiddenClass);\n  }\n\n  /**\n   * Hash/history usage\n   */\n  onHashChange(e) {\n    const $hashTab = this.getTab(window.location.hash);\n    if (!$hashTab) {\n      return;\n    }\n    // Prevent changing hash\n    if (this.changingHash) {\n      this.changingHash = false;\n      return;\n    }\n    // Set active tba according to URL hash\n    const $previousTab = this.getCurrentTab();\n    this.hideTab($previousTab);\n    this.showTab($hashTab);\n    $hashTab.focus();\n  }\n  createHistoryEntry($tab) {\n    let $panel = this.getPanel($tab);\n    // This code prevents the page from jumping to the new target hash.\n    // 1. Saves the panel ID into memory.\n    // 2. Remove the ID from the panel.\n    // 3. Change the hash in the URL.\n    // 4. Applies the ID from memory back to the panel.\n    const id = $panel.id;\n    $panel.id = \"\";\n    this.changingHash = true;\n    window.location.hash = this.getHref($tab).slice(1);\n    $panel.id = id;\n  }\n\n  /**\n   * Tab methods\n   */\n  getTab(hash) {\n    return this.$module.querySelector(`.fs-tabs__tab[href=\"${hash}\"]`);\n  }\n  getCurrentTab() {\n    return this.$module.querySelector(\".fs-tabs__item--current .fs-tabs__tab\");\n  }\n  hideTab($tab) {\n    this.unhighlightTab($tab);\n    this.hidePanel($tab);\n  }\n  showTab($tab) {\n    this.highlightTab($tab);\n    this.showPanel($tab);\n  }\n  unhighlightTab($tab) {\n    $tab.setAttribute(\"aria-selected\", \"false\");\n    $tab.parentNode.classList.remove(\"fs-tabs__item--current\");\n    $tab.setAttribute(\"tabindex\", \"-1\");\n  }\n  highlightTab($tab) {\n    $tab.setAttribute(\"aria-selected\", \"true\");\n    $tab.parentNode.classList.add(\"fs-tabs__item--current\");\n    $tab.setAttribute(\"tabindex\", \"0\");\n  }\n  activateNextTab() {\n    const $currentTab = this.getCurrentTab();\n    const $nextTablistItem = $currentTab.parentNode.nextElementSibling;\n    let $nextTab;\n    if ($nextTablistItem) {\n      $nextTab = $nextTablistItem.querySelector(\".fs-tabs__tab\");\n    }\n    if ($nextTab) {\n      this.hideTab($currentTab);\n      this.showTab($nextTab);\n      $nextTab.focus();\n      this.createHistoryEntry($nextTab);\n    }\n  }\n  activatePreviousTab() {\n    const $currentTab = this.getCurrentTab();\n    const $previousTablistItem = $currentTab.parentNode.previousElementSibling;\n    let $previousTab;\n    if ($previousTablistItem) {\n      $previousTab = $previousTablistItem.querySelector(\".fs-tabs__tab\");\n    }\n    if ($previousTab) {\n      this.hideTab($currentTab);\n      this.showTab($previousTab);\n      $previousTab.focus();\n      this.createHistoryEntry($previousTab);\n    }\n  }\n\n  /**\n   * Panel methods\n   */\n  getPanel($tab) {\n    return this.$module.querySelector(this.getHref($tab));\n  }\n  showPanel($tab) {\n    const $panel = this.getPanel($tab);\n    $panel.classList.remove(this.panelHiddenClass);\n  }\n  hidePanel($tab) {\n    const $panel = this.getPanel($tab);\n    $panel.classList.add(this.panelHiddenClass);\n  }\n\n  /**\n   * Mouse/keyboard handlers\n   */\n  onTabClick(e) {\n    if (!e.target.classList.contains(\"fs-tabs__tab\")) {\n      return false;\n    }\n    e.preventDefault();\n    const $newTab = e.target;\n    const $currentTab = this.getCurrentTab();\n    this.hideTab($currentTab);\n    this.showTab($newTab);\n    this.createHistoryEntry($newTab);\n  }\n  onTabKeydown(e) {\n    switch (e.which || e.keyCode) {\n      case KeyCodes().LEFT:\n      case KeyCodes().UP:\n        this.activatePreviousTab();\n        e.preventDefault();\n        break;\n      case KeyCodes().RIGHT:\n      case KeyCodes().DOWN:\n        this.activateNextTab();\n        e.preventDefault();\n        break;\n    }\n  }\n\n  /**\n   * Helpers\n   */\n  getHref($tab) {\n    const href = $tab.getAttribute(\"href\");\n    const hash = href.slice(href.indexOf(\"#\"), href.length);\n    return hash;\n  }\n}\n\nexport default Tabs;\n"],"names":["KeyCodes","Tabs","constructor","$module","this","$tabs","querySelectorAll","$tablist","querySelector","$tablistItems","panelHiddenClass","create","setAttribute","forEach","$item","setAttributes","boundTabClick","onTabClick","bind","boundTabKeydown","onTabKeydown","addEventListener","hideTab","$activeTab","getTab","window","location","hash","showTab","boundOnHashChange","onHashChange","destroy","removeAttribute","removeEventListener","unsetAttributes","$tab","panelId","getHref","slice","$panel","getPanel","id","classList","add","remove","e","$hashTab","$previousTab","changingHash","getCurrentTab","focus","createHistoryEntry","unhighlightTab","hidePanel","highlightTab","showPanel","parentNode","activateNextTab","$currentTab","$nextTablistItem","nextElementSibling","$nextTab","activatePreviousTab","$previousTablistItem","previousElementSibling","target","contains","preventDefault","$newTab","which","keyCode","LEFT","UP","RIGHT","DOWN","href","getAttribute","indexOf","length"],"mappings":"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"}